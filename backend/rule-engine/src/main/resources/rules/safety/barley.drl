package rules.safety;

import com.agriscope.rule_engine.domain.model.CurrentWeatherData
import com.agriscope.rule_engine.domain.model.Seed
import com.agriscope.rule_engine.domain.model.Recommendation
import com.agriscope.rule_engine.domain.enums.SeedType
import com.agriscope.rule_engine.domain.enums.RecommendationType

global java.util.List recommendations;

rule "Barley - Frost Alert"
when
    $seed: Seed(seedType == SeedType.BARLEY)
    $weather: CurrentWeatherData(temperature_2m < $seed.minTemperature)
then
    Recommendation rec = new Recommendation();
    rec.setUserId($weather.getUserId());
    rec.setRecommendedSeed(SeedType.BARLEY);
    rec.setRecommendationType(RecommendationType.FROST_ALERT);
    rec.setAdvice("INSPECT_FIELDS_FOR_FROST_DAMAGE");
    rec.setReasoning("Temperature (" + $weather.getTemperature_2m() + "C) below frost risk threshold (" + $seed.getFrostRiskTemperature() + "°C)");
    rec.setWeatherTimestamp($weather.getTime());
    recommendations.add(rec);
end

rule "Barley - Heat Stress Alert"
when
    $seed: Seed(seedType == SeedType.BARLEY)
    $weather: CurrentWeatherData(temperature_2m > $seed.heatStressTemperature)
then
    Recommendation rec = new Recommendation();
    rec.setUserId($weather.getUserId());
    rec.setRecommendedSeed(SeedType.BARLEY);
    rec.setRecommendationType(RecommendationType.HEAT_ALERT);
    rec.setAdvice("START_MOBILE_IRRIGATION");
    rec.setReasoning("Temperature (" + $weather.getTemperature_2m() + "C) above heat stress threshold (" + $seed.getHeatStressTemperature() + "°C)");
    rec.setWeatherTimestamp($weather.getTime());
    recommendations.add(rec);
end

rule "Barley - Optimal Conditions"
when
    $seed: Seed(seedType == SeedType.BARLEY)
    $weather: CurrentWeatherData(
        temperature_2m >= $seed.minTemperature && temperature_2m <= $seed.maxTemperature
    )
then
    Recommendation rec = new Recommendation();
    rec.setUserId($weather.getUserId());
    rec.setRecommendedSeed(SeedType.BARLEY);
    rec.setRecommendationType(RecommendationType.CONTINUE_NORMAL);
    rec.setAdvice("CONTINUE_NORMAL_BARLEY_OPERATIONS");
    rec.setReasoning("Optimal conditions for barley - temp: " + $weather.getTemperature_2m() + "C, rain: " + $weather.getRain() + "mm");
    rec.setWeatherTimestamp($weather.getTime());
    recommendations.add(rec);
end