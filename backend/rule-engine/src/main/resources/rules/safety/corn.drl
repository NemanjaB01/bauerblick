package rules.safety;

import com.agriscope.rule_engine.domain.model.CurrentWeatherData
import com.agriscope.rule_engine.domain.model.Seed
import com.agriscope.rule_engine.domain.model.Recommendation
import com.agriscope.rule_engine.domain.enums.SeedType
import com.agriscope.rule_engine.domain.enums.RecommendationType

global java.util.List recommendations;

rule "Corn - Frost Alert"
when
    $seed: Seed(seedType == SeedType.CORN)
    $weather: CurrentWeatherData(temperature_2m < $seed.minTemperature)
then
    Recommendation rec = new Recommendation();
    rec.setUserId($weather.getUserId());
    rec.setRecommendedSeed(SeedType.CORN);
    rec.setRecommendationType(RecommendationType.FROST_ALERT);
    rec.setAdvice("CHECK_GROWING_POINT_RECOVERY");
    rec.setReasoning("Temperature (" + $weather.getTemperature_2m() + "C) below frost risk threshold (" + $seed.getFrostRiskTemperature() + "°C)");
    rec.setWeatherTimestamp($weather.getTime());
    recommendations.add(rec);
end

rule "Corn - Heat Stress Alert"
when
    $seed: Seed(seedType == SeedType.CORN)
    $weather: CurrentWeatherData(temperature_2m > $seed.heatStressTemperature)
then
    Recommendation rec = new Recommendation();
    rec.setUserId($weather.getUserId());
    rec.setRecommendedSeed(SeedType.CORN);
    rec.setRecommendationType(RecommendationType.HEAT_ALERT);
    rec.setAdvice("IRRIGATE_TO_SAVE_POLLINATION");
    rec.setReasoning("Temperature (" + $weather.getTemperature_2m() + "C) above heat stress threshold (" + $seed.getHeatStressTemperature() + "°C)");
    rec.setWeatherTimestamp($weather.getTime());
    recommendations.add(rec);
end

rule "Corn - Optimal Conditions"
when
    $seed: Seed(seedType == SeedType.CORN)
    $weather: CurrentWeatherData(
        temperature_2m >= $seed.minTemperature && temperature_2m <= $seed.maxTemperature
    )
then
    Recommendation rec = new Recommendation();
    rec.setUserId($weather.getUserId());
    rec.setRecommendedSeed(SeedType.CORN);
    rec.setRecommendationType(RecommendationType.CONTINUE_NORMAL);
    rec.setAdvice("CONTINUE_NORMAL_CORN_OPERATIONS");
    rec.setReasoning("Optimal conditions for corn - temp: " + $weather.getTemperature_2m() + "C, rain: " + $weather.getRain() + "mm");
    rec.setWeatherTimestamp($weather.getTime());
    recommendations.add(rec);
end